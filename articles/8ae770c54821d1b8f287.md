---
title: "go/goreleaserã§åˆã‚ã¦ã®CLIãƒ„ãƒ¼ãƒ«ä½œã‚Š" # è¨˜äº‹ã®ã‚¿ã‚¤ãƒˆãƒ«
emoji: "ğŸš²" # ã‚¢ã‚¤ã‚­ãƒ£ãƒƒãƒã¨ã—ã¦ä½¿ã‚ã‚Œã‚‹çµµæ–‡å­—ï¼ˆ1æ–‡å­—ã ã‘ï¼‰
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢è¨˜äº‹
topics: ["go", "homebrew", "cli", "goreleaser"] # ã‚¿ã‚°ã€‚["markdown", "rust", "aws"]ã®ã‚ˆã†ã«æŒ‡å®šã™ã‚‹
published: true # å…¬é–‹è¨­å®šï¼ˆfalseã«ã™ã‚‹ã¨ä¸‹æ›¸ãï¼‰
---

# ã¯ã˜ã‚ã«
åˆã‚ã¾ã—ã¦ï¼
æ™®æ®µã¯vueã¨ã‹reactãªã©ã®ã‚¦ã‚§ãƒ–ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’æ›¸ã„ã¦ã„ã‚‹å¤§å­¦ç”Ÿã§ã™ã€‚
ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ã®é¸è€ƒã‚’é€šã‚‹ãŸã‚ã«goã‚’èº«ã«ã¤ã‘ãªã‘ã‚Œã°ãªã‚‰ãªããªã£ãŸã®ã§å‹‰å¼·ãŒã¦ã‚‰CLIãƒ„ãƒ¼ãƒ«ã‚’ä½œæˆã—ã¾ã—ãŸã€‚
## æ³¨æ„ç‚¹
goã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã€åŸºæœ¬æ–‡æ³•ã€go moduleã®è¨­å®šãªã©ã¯å‰²æ„›ã—ã¾ã™ã€‚
è‡ªåˆ†ãŒè©°ã¾ã£ãŸã¨ã“ã‚ã‚’é‡ç‚¹çš„ã«æ›¸ã„ã¦ã„ã¾ã™ã€‚
# ä½œæˆã—ãŸã‚‚ã®
ãã®æ—¥ã®å¤©æ°—ã¨ç¿Œæ—¥ã®å¤©æ°—äºˆå ±ã‚’å–å¾—ã§ãã‚‹CLIãƒ„ãƒ¼ãƒ«ã‚’ä½œæˆã—ã¾ã—ãŸã€‚
ã‚ˆã‹ã£ãŸã‚‰ã¿ã¦ã„ã£ã¦ãã ã•ã„ã€‚
[mmmommm/tenki](https://github.com/mmmommm/tenki)

# ã‚³ãƒ¼ãƒ‰ã«ã¤ã„ã¦
cobraãªã©ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒã‚ã‚‹ã®ã¯çŸ¥ã£ã¦ã„ã¾ã—ãŸãŒã€ä»Šå›ã¯ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®æ•°ã‚‚å¤šããªã„ã“ã¨ã‚‚ã‚ã‚Šã€flagã‚’ä½¿ç”¨ã—ã¾ã—ãŸã€‚
æ¥µåŠ›çŸ­ãã—ã¦ã„ã‚‹ã¤ã‚‚ã‚Šã§ã™ãŒã€å°‘ã—é•·ã„ã‹ã‚‚ã—ã‚Œãªã„ã§ã™ã€‚

```go:main.go
func main() {
	const defaultPrefecture = ""
	var cPrefecture, nPrefecture, string
	var showVersion bool
	flag.StringVar(&cPrefecture, "current", defaultPrefecture, "--curennt <çœŒå> returns current weather information where you are.")
	flag.StringVar(&cPrefecture, "c", defaultPrefecture, "-c <çœŒå> returns current weather information where you are.")
	flag.StringVar(&fPrefecture, "forecast", defaultPrefecture, "--forecast <çœŒå> returns current weather information where you are.")
	flag.StringVar(&fPrefecture, "f", defaultPrefecture, "-f <çœŒå> returns current weather information where you are.")
	flag.Parse()
	// -cã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®æ™‚ã®å‡¦ç†ã‚’æ›¸ã
	if cPrefecture != "" && fPrefecture == ""ã€€{
		tenki.CurrentWeather(cPrefecture)
	// -fã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®æ™‚ã®å‡¦ç†ã‚’æ›¸ã
	} else if cPrefecture == "" && fPrefecture != "" &&ã€€{
		tenki.ForecastWeather(fPrefecture)
	} else {
		fmt.Printf("%s: option arguments is empty !! please type prefecture name. \n", os.Args[0])
		fmt.Printf("%s: try 'tenki --help' or 'tenki -h' for more information\n", os.Args[0])
		os.Exit(1)
	}
}
```
å°‘ã—çœç•¥ã—ã¦ã„ã¾ã™ãŒã€mainé–¢æ•°ã¯ã“ã®ã‚ˆã†ã«ãªã£ã¦ãŠã‚Šã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã”ã¨ã«åˆ†å²ã—ã¦tenkiã¨ã„ã†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚ã‚‹é–¢æ•°ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚
å…¨ã¦ã®ã‚³ãƒ¼ãƒ‰ã¯[ã“ã“](https://github.com/mmmommm/tenki/blob/main/main.go)ã«ã‚ã‚Šã¾ã™ã€‚


```go:cmd/current.go
func CurrentWeather(cPrefecture string) {
	err := godotenv.Load()
	if err != nil {
		log.Fatal("Error loading .env file")
	}

	var city string
	city = sub.Prefecture(cPrefecture)

	token := os.Getenv("WEATHER_TOKEN")                           // APIãƒˆãƒ¼ã‚¯ãƒ³
	endPoint := "https://api.openweathermap.org/data/2.5/weather" // APIã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

	// ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¨­å®š
	values := url.Values{}
	values.Set("q", city)
	values.Set("APPID", token)
	// ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æŠ•ã’ã‚‹
	res, err := http.Get(endPoint + "?" + values.Encode())
	if res != nil {
		defer res.Body.Close()
	}
	if err != nil {
		fmt.Println(err)
	}
	defer res.Body.Close()
	// ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’èª­ã¿å–ã‚Š
	bytes, err := ioutil.ReadAll(res.Body)
	if err != nil {
		fmt.Println(err)
	}
	// JSONãƒ‘ãƒ¼ã‚¹
	var apiRes OpenWeatherMapAPIResponse
	if err := json.Unmarshal(bytes, &apiRes); err != nil {
		fmt.Println(err)
	}

	aa := sub.ASCIIart(apiRes.Weather[0].Icon)

	fmt.Printf("----------------------------------------\n")
	fmt.Printf("æ™‚åˆ»:     %s\n", time.Unix(apiRes.Dt, 0))
	fmt.Printf("å¤©æ°—:     %s\n", apiRes.Weather[0].Main)
	fmt.Printf("è©³ç´°:     %s\n", apiRes.Weather[0].Description)
	fmt.Printf("å¹³å‡æ°—æ¸©: %s Â°C\n", fmt.Sprintf("%.1f", sub.Change(apiRes.Main.Temp))) // ã‚±ãƒ«ãƒ“ãƒ³ã§å–å¾—ã•ã‚Œã‚‹
	fmt.Printf("%s\n", aa)
	fmt.Printf("----------------------------------------\n")
}
```
é•·ããªã£ã¦ã—ã¾ã†ã®ã§cã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®æ™‚ã ã‘æ›¸ãã¾ã™ãŒã€ä»Šå›ã¯[openweathermapAPI](https://openweathermap.org/)ã‚’ä½¿ç”¨ã—ãŸã®ã§.envã«APIkeyã‚’æ¸¡ã—ã¦ãã‚Œã‚’[godotenv](https://github.com/joho/godotenv)ã‚’ä½¿ã£ã¦å–ã£ã¦ãã¦ã„ã¾ã™ã€‚
jsonã®å®šç¾©ã®ã›ã„ã§é•·ããªã£ã¦ã—ã¾ã†ã®ã§çœç•¥ã—ã¾ã™ã€‚
å…¨ã¦ã®ã‚³ãƒ¼ãƒ‰ã¯[ã“ã“](https://github.com/mmmommm/tenki/blob/main/cmd/current.go)ã«ã‚ã‚Šã¾ã™ã€‚

`sub.ASCIIart()`ã¯å¤©æ°—ã«å¿œã˜ã¦ãã‚Œã«å¯¾å¿œã™ã‚‹å¤©æ°—ã®ç”»åƒã‚’ã‚¢ã‚¹ã‚­ãƒ¼ã‚¢ãƒ¼ãƒˆåŒ–ã—ãŸã‚‚ã®ã‚’å–å¾—ã—ã¦ãã‚‹é–¢æ•°ã§ã™ã€‚
[ã‚¢ã‚¹ã‚­ãƒ¼ã‚¢ãƒ¼ãƒˆã®ä¿å­˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª](https://github.com/mmmommm/tenki/tree/main/aa)
`sub.Change()`ã¯APIã‹ã‚‰æ°—æ¸©ãŒã‚±ãƒ«ãƒ“ãƒ³ã§å–å¾—ã•ã‚Œã‚‹ã®ã§-273.15ã—ã¦æ‘‚æ°ã«å¤‰æ›ã™ã‚‹é–¢æ•°ã§ã™ã€‚
`fmt.Sprintf("%.1f", ä½•ã‹ã—ã‚‰ã®string)`ã¨ã™ã‚‹ã¨å°æ•°ç‚¹ç¬¬ä¸€ä½ã§åˆ‡ã£ã¦ãã‚Œã‚‹ã®ã§çµ±ä¸€ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚
[subãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ã“ã¡ã‚‰](https://github.com/mmmommm/tenki/tree/main/sub)

## ãƒªãƒªãƒ¼ã‚¹ã«ã¤ã„ã¦
[goreleaser](https://goreleaser.com/)ã‚’ä½¿ç”¨ã—ã¾ã—ãŸã€‚
:::message alert
æ°—ã‚’ã¤ã‘ã¦æ¬²ã—ã„ã¨ã“ã‚
:::
homebrewã®formulaã‚’è‡ªå‹•ã§ä½œæˆã—ã¦ãã‚Œã‚‹ã‚‰ã—ã„ã®ã§ã‚„ã£ã¦ã„ãŸã®ã§ã™ãŒã€ã¯ã˜ã‚ã«GitHubActionsã§ã‚„ã£ã¦ã„ãŸã¨ã“ã‚ã€[artifactã®ã‚¨ãƒ©ãƒ¼](https://github.com/goreleaser/goreleaser/issues/1382)ã§æ°¸é ã«ã¤ã¾ã¥ãã€å…¬å¼ã®githubã®issueã«ã‚‚è§£æ±ºæ³•ãŒå‡ºã¦ã„ãªã‹ã£ãŸã®ã§CircleCIã«å¤‰ãˆãŸã¨ã“ã‚ã†ã¾ãè¡Œãã¾ã—ãŸã€‚
ä»¥ä¸‹ã¯ç§ã®`.goreleaser.yml`ã¨`.circleci/config.yml`ã§ã™
```yml:.goreleaser.yml
before:
  hooks:
    - go mod download
    - go generate ./...
builds:
  - env:
      - CGO_ENABLED=0
    goos:
      - linux
      - windows
      - darwin
archives:
  - replacements:
      darwin: Darwin
      linux: Linux
      windows: Windows
      386: i386
      amd64: x86_64
checksum:
  name_template: 'checksums.txt'
snapshot:
  name_template: "{{ .Tag }}-next"
changelog:
  sort: asc
  filters:
    exclude:
      - '^docs:'
      - '^test:'
brews:
  -
    tap:
      owner: mmmommm
      name: homebrew-tenki
    description: Returns weather forecast in perticular prefecture.
    homepage: â€œhttps://github.com/mmmommm/tenkiâ€
    commit_author:
      name: goreleaserbot
      email: goreleaser@carlosbecker.com
    install: |
      bin.install "tenki"
```
```yml:.circleci/config.yml
version: 2.1
workflows:
  main:
    jobs:
      - release:
          # Only run this job on git tag pushes
          filters:
            branches:
              ignore: /.*/
            tags:
              only: /v[0-9]+(\.[0-9]+)*(-.*)*/
jobs:
  release:
    docker:
      - image: circleci/golang:1.15
    steps:
      - checkout
      - run: curl -sL https://git.io/goreleaser | bash
```

# ãƒªãƒªãƒ¼ã‚¹æ™‚ã«è©°ã¾ã£ãŸã“ã¨
:::message
å…¬å¼ã‚’ã¿ã¦ã„ãªã‹ã£ãŸã“ã¨
:::

qiitaãªã©ã«ãŸãã•ã‚“ã®è¨˜äº‹ãŒã‚ã‚Šã¾ã™ãŒbrewã¯æ›´æ–°ã•ã‚Œã¦brewsã«ãªã£ã¦ã„ã¾ã™ã—ã€ãã¡ã‚“ã¨[ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://goreleaser.com/)ã‚’ã¿ã¦å¯¾å¿œã—ãŸã‚‚ã®ã‚’æ›¸ã‹ãªã„ã¨ã‚¨ãƒ©ãƒ¼ã‚’åã‹ã‚Œã¾ã™æ°—ã‚’ã¤ã‘ã¦ãã ã•ã„ã€ç¾æ™‚ç‚¹(2020-10-17)ã§ã¯ã“ã‚Œã§å‹•ãã¾ã—ãŸã€‚

:::message
homebrew-ãƒ„ãƒ¼ãƒ«åã®ãƒªãƒã‚¸ãƒˆãƒªä½œæˆ
:::

goreleaserbotãŒã‚³ãƒŸãƒƒãƒˆã—ã¦ãã‚Œãªãã¦è©°ã¾ã‚Šã¾ã—ãŸã€‚
æ‰‹é †ã¨ã—ã¦ã¯
- `homebrew-ãƒ„ãƒ¼ãƒ«å`ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œæˆã™ã‚‹ã€‚
- `git init`ãªã©ã—ã¦ã‚³ãƒŸãƒƒãƒˆã§ãã‚‹ã‚ˆã†ã«ã—ã¦ãŠãã€‚
- goreleaserbotã‚’ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚¿ã¨ã—ã¦ãƒªãƒã‚¸ãƒˆãƒªã«æ‹›å¾…ã™ã‚‹ã€‚
- ã‚¿ã‚°åã‚’ã¤ã‘ã¦ãƒ„ãƒ¼ãƒ«å´ã®ãƒªãƒã‚¸ãƒˆãƒªã®ã‚³ãƒ¼ãƒ‰ã‚’pushã™ã‚‹

ã‚’ã™ã‚Œã°ã‚ˆã„ã§ã™ã€ã“ã®è¾ºãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«æ›¸ã„ã¦ãªãã¦æ„å‘³ã‚ã‹ã‚‰ãªã‹ã£ãŸã§ã™ã€‚
[ç§ã®ãƒ„ãƒ¼ãƒ«ã®homebrew-tenki](https://github.com/mmmommm/homebrew-tenki)

æ‹›å¾…ã®ä»•æ–¹ã¯`homebrew-ãƒ„ãƒ¼ãƒ«å`ã®ãƒªãƒã‚¸ãƒˆãƒªã®`settings`ã‹ã‚‰
![](https://storage.googleapis.com/zenn-user-upload/tgfemzglpgvft6rptx39o943gvop)
`Manage access`ã‚’æŠ¼ã—ã¦å³å´ã«ã‚ã‚‹`invite a collaborator`ã‚’æŠ¼ã—
`goreleaserbot`ã¨æ¤œç´¢ã—ã¦è¿½åŠ ã™ã‚Œã°ã§ãã¾ã™ã€‚

æœ€å¾Œã«é–¢ã—ã¦ã¯goreleaserã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚‚æ›¸ã„ã¦ã‚ã‚Šã¾ã™ãŒ
1 ã€€ä½•ã‹ã—ã‚‰ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã
2 `git add` `git commit`ã™ã‚‹ã€‚
3 `git tag v1.0.0`ã™ã‚‹ã€‚ï¼ˆè‡ªåˆ†ã®ãƒªãƒªãƒ¼ã‚¹ã®æ¬¡ã®tagã§ã™ã€‚æœ€åˆãªã‚‰v0.0.1ï¼‰
4 `git push origin v1.0.0`ã™ã‚‹ã€‚ï¼ˆãã‚Œãã‚Œä¸Šã®ã§ã¤ã‘ãŸtagã‚’æŒ‡å®šã—ã¦ãã ã•ã„ï¼‰
5 `git push origin main`ã™ã‚‹ã€‚ï¼ˆãƒ–ãƒ©ãƒ³ãƒåˆ‡ã£ã¦ã„ã‚‹ã®ã§ã‚ã‚Œã°`git push origin head`ï¼‰
ã‚’ã™ã‚Œã°è‰¯ã„ã§ã™ã€‚
CIãŒtagã‚’ãƒ—ãƒƒã‚·ãƒ¥ã—ãŸæ™‚ã«å‹•ãã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã®ã§tagã‚’ãƒ—ãƒƒã‚·ãƒ¥ã—ãªã„ã¨å‹•ãã¾ã›ã‚“ã€‚
tagã‚’ãƒ—ãƒƒã‚·ãƒ¥ã—ãŸå¾Œã«ãƒªãƒã‚¸ãƒˆãƒªã‚’ã¿ã«ã„ã£ãŸã‚‰goreleaserbotãŒcommitã—ã¦ã‚‹ã¯ãšã§ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/dqj5jho9zghr00llovydmu7gdfp3)

:::message
CircleCIã«GITHUB_TOKENã‚’è¨­å®šã—ã¦ãªã‹ã£ãŸ
:::
goreleaserã‚’å‹•ã‹ã™ã®ã«GITHUB_TOKENãŒå¿…è¦ãªã®ã§è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ã‚„ã‚Šæ–¹ã¯
dashboardã®ã“ã“ã‹ã‚‰ProjectSettingsã‚’é–‹ã
![](https://storage.googleapis.com/zenn-user-upload/ocsycldai593kz7kwg8vlt7vbj4s)
ã“ã‚“ãªç”»é¢ã«è¡Œãã¨æ€ã†ã®ã§
![](https://storage.googleapis.com/zenn-user-upload/2hj1d8promwx2pa005c48nj5y625)
å·¦ã®Environment Variablesã‚’é¸ã‚“ã§GITHUB_TOKENã¨ã„ã†åå‰ã§APIKeyã‚’ç™»éŒ²ã™ã‚Œã°è‰¯ã„ã§ã™ã€‚

GITHUB_TOKENã¯goreleaserã®è¨­å®šã®æ™‚ã«å–å¾—ã—ã¦ã„ã‚‹ã®ã§å¤§ä¸ˆå¤«ã ã¨æ€ã„ã¾ã™ãŒå–å¾—æ–¹æ³•ãŒã‚ã‹ã‚‰ãªã„å ´åˆã¯[ã“ã¡ã‚‰](https://docs.github.com/ja/free-pro-team@latest/github/authenticating-to-github/creating-a-personal-access-token)ã‚’è¦‹ã‚Œã°ã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚
:::message alert
tokenå–å¾—æ™‚ã«ã¯æ¨©é™ã§repoã«ãƒã‚§ãƒƒã‚¯ã‚’ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
:::

# ç¢ºèª
CIãªã©ã®å®Ÿè¡ŒãŒã†ã¾ãã„ã£ãŸã‚‰ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãªã©ã§
`brew tap {ãƒ¦ãƒ¼ã‚¶ãƒ¼å}/{ãƒ„ãƒ¼ãƒ«å}`
`brew install {ãƒ¦ãƒ¼ã‚¶ãƒ¼å}/{ãƒ„ãƒ¼ãƒ«å}/{ãƒ„ãƒ¼ãƒ«å}`
ã‚’ã—ã¦å‹•ä½œç¢ºèªã‚’ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

ã“ã‚Œã§ãã¡ã‚“ã¨ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã‚Œã°homebrewã«å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ğŸ‰ğŸ‰

# æœ€å¾Œã«
ã‚ã‚‹ç¨‹åº¦æ–‡æ³•ã¯ã‚ã‹ã£ã¦ã„ã¾ã—ãŸãŒgoã§ä½œæˆã—ãŸã®ã¯åˆã‚ã¦ã ã£ãŸã®ã§è©°ã¾ã‚ŠãªãŒã‚‰ã‚‚é€²ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚ï¼ˆã¾ã å®Œæˆã—ã¦ã„ã¾ã›ã‚“ãŒï¼‰
è©°ã¾ã£ã¦ã„ã‚‹æ–¹ã®æ‰‹åŠ©ã‘ã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚