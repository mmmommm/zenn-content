---
title: "denoã§ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã—ã¦slackã«æŠ•ã’ã‚‹"
emoji: "ğŸ’¨"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [deno]
published: true
---

GWã«`deno`ã§ä½•ã‹ä½œã‚‹ã¨ã„ã†ç›®æ¨™ã‚’ç«‹ã¦ã¦ã„ãŸã®ã§ç°¡å˜ã§ã™ãŒã€slack botã‚’ä½œæˆã—ã¾ã—ãŸã€‚

# denoã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
https://zenn.dev/azukiazusa/articles/804439f5afabe7#%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97

[azukiazusaã•ã‚“](https://zenn.dev/azukiazusa)ã®è¨˜äº‹ã‚’å‚è€ƒã«`Hello World!`ãŒã‚µãƒ¼ãƒãƒ¼ã§è¿”ã›ã‚Œã°å•é¡Œç„¡ã„ã§ã™ã€‚
:::message
vscodeã‚’ä½¿ã£ã¦ã„ã‚‹æ–¹ã¯ãã¡ã‚“ã¨æ‹¡å¼µæ©Ÿèƒ½ã‚’å…¥ã‚Œã¾ã—ã‚‡ã†ã€ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¾ã™ã€‚
:::

# å®Œæˆå“
https://github.com/CA-22-engineers/github_trending_repo

# slackã®ãƒãƒ£ãƒ³ãƒãƒ«ã«ãƒ†ã‚­ã‚¹ãƒˆã‚’é£›ã°ã™
## slackã®Tokenã®ä½œæˆã€botã®æ‹›å¾…
ã¾ãšã¯tokenã‚’ã¨ã£ã¦ãã¾ã™
[ã“ã¡ã‚‰ã®è¨˜äº‹](https://www.lisz-works.com/entry/get-slack-api)ã®é€šã‚Šã«ã™ã‚Œã°ã¨ã£ã¦ã“ã‚Œã‚‹ã¯ãšã§ã™ã€‚
ãã¡ã‚“ã¨TokenãŒä½¿ãˆã‚‹ã‹ã¾ã§ç¢ºèªã—ã€ãƒãƒ£ãƒ³ãƒãƒ«ã«botã‚’æ‹›å¾…ã—ã¦ãã ã•ã„ã€‚

## ã‚³ãƒ¼ãƒ‰
ã“ã¡ã‚‰ã®ã‚³ãƒ¼ãƒ‰ã‚’å‚è€ƒã«ã—ã¾ã—ãŸã€‚
ã‚ã‚“ã¾ã‚Šä¾å­˜ã—ãŸãç„¡ã„ã®ã§æ›¸ãæ›ãˆã¾ã—ãŸã€‚
https://deno.land/x/simple_slackbot@v0.0.1/src

```ts:connect_slack.ts
export const sendMessage = async(token: string, channel: string, text: string) => {
  const response = await fetch('https://slack.com/api/chat.postMessage', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json; charset=UTF-8',
      'Authorization': `Bearer ${token}`,
    },
    body: JSON.stringify({
      channel,
      text,
      as_user: true,
    }),
  });
  return response;
}
```

```ts:index.ts
import { sendMessage } from './connect_slack.ts';
import 'https://deno.land/x/dotenv/load.ts';

const slacktoken = Deno.env.get('SLACK_TOKEN')
if (slacktoken) {
  await sendMessage(slacktoken, '#ãƒãƒ£ãƒ³ãƒãƒ«å', 'hello world!');
}
```

ç‰¹åˆ¥ãªã“ã¨ã¯ã—ã¦ã„ãªã„ã§ã™ã€ã¨ã£ã¦ããŸ`slack_token`ã‚’

```env:.env
SLACK_TOKEN={ã¨ã£ã¦ããŸslack_token}
```

ã“ã‚“ãªæ„Ÿã˜ã§`.env`ã«å…¥ã‚Œã¦ã‚ã’ã¦

:::message alert
.gitignoreã«ãã¡ã‚“ã¨è¨­å®šã—ã¾ã—ã‚‡ã†
:::

```
$ deno run --allow-net --allow-read --allow-env index.ts
```

ã‚’å®Ÿè¡Œã™ã‚‹ã¨æŒ‡å®šã—ãŸãƒãƒ£ãƒ³ãƒãƒ«ã«`hello world!`ã¨é€ä¿¡ã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚

:::message
denoã§ã¯æ¨©é™ã‚’ãã¡ã‚“ã¨æ˜ç¤ºã—ãªã„ã¨ã„ã‘ãªã„ã®ã§`--allow-net`ãªã©ãŒå¿…è¦ã§ã™ã€‚
https://deno.land/manual/getting_started/permissions
:::

# ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã§ãƒ‡ãƒ¼ã‚¿ã‚’ã¨ã£ã¦ãã‚‹
ä»Šå›ã¯githubã®ãƒˆãƒ¬ãƒ³ãƒ‰ã«ã‚ã‚‹ãƒªãƒã‚¸ãƒˆãƒªã‚’ã¨ã£ã¦ãã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚
https://github.com/trending

:::message alert
æ³¨æ„äº‹é …ã§ã™ã€æ°—ã‚’ã¤ã‘ã¾ã—ã‚‡ã†

[å²¡å´å¸‚ç«‹ä¸­å¤®å›³æ›¸é¤¨äº‹ä»¶](https://ja.wikipedia.org/wiki/%E5%B2%A1%E5%B4%8E%E5%B8%82%E7%AB%8B%E4%B8%AD%E5%A4%AE%E5%9B%B3%E6%9B%B8%E9%A4%A8%E4%BA%8B%E4%BB%B6)
[Webã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã®æ³¨æ„äº‹é …ä¸€è¦§](https://qiita.com/nezuq/items/c5e827e1827e7cb29011)
:::

## ã‚³ãƒ¼ãƒ‰
https://scrapingant.com/blog/deno-web-scraping

å‚è€ƒã«ã—ã¾ã—ãŸã€‚
:::message
ä¸Šè¨˜ã®è¨˜äº‹ã ã¨documentã®å‹ãŒanyã«ãªã£ã¦ã„ã¾ã™ãŒã€ãã‚Œã§ã¯ã‚¨ãƒ©ãƒ¼ã§å‹•ã‹ãªã„ã§ã™ã€‚
:::

```ts:github.ts
import { DOMParser } from 'https://deno.land/x/deno_dom/deno-dom-wasm.ts';

const url = 'https://github.com/trending';

let url_list: string[] = [];
const url_prefix = 'https://github.com/'
const res = await fetch(url);
const html = await res.text();
const doc = new DOMParser().parseFromString(html, 'text/html');
const ref = doc?.querySelector('#js-pjax-container>.position-relative>.Box');

export const scrapingRepo = (): string[] => {
  const repositories = ref?.querySelectorAll('div>.Box-row>h1>a');
  if (repositories) {
    for(const repositoty of repositories) {
      url_list.push(url_prefix + repositoty.textContent.replace('\n\n', '').replace(/\s+/g, '').trim())
    }
  }
  return url_list
}
```

ã‚‚ã†å°‘ã—è‰¯ã„å–ã‚Šæ–¹ã‚ã‚‹ã¨æ€ã„ã¾ã™ãŒã€ã“ã‚“ãªæ„Ÿã˜ã§ãƒªãƒã‚¸ãƒˆãƒªã®urlã‚’é…åˆ—ã§è¿”ã—ã¦ãã¦ã„ã¾ã™ã€‚

blocksã§é€ã‚ŠãŸã„ã®ã§sendMessageé–¢æ•°ã®å¼•æ•°ã‚’å¤‰æ›´ã—ã¾ã™ã€‚
block kitsã«ã¤ã„ã¦ã¯[PLAIDã®è¨˜äº‹](https://tech.plaid.co.jp/slack_api_spec_trend_2020/)ãŒã‚ã‹ã‚Šã‚„ã™ã‹ã£ãŸã§ã™ã€‚

```ts:connect_slack.ts
export const sendMessage = async(token: string, channel: string, blocks: any) {}
```

```ts:slack.ts
import { sendMessage } from './connect_slack.ts';
import { scrapingRepo } from './github.ts';
import 'https://deno.land/x/dotenv/load.ts';

const array = await scrapingRepo()
const slacktoken = Deno.env.get('SLACK_TOKEN')
if (slacktoken) {
  for (let i = 0; i < 10; i++) {
    await sendMessage(slacktoken, '#bot_test',
    [
      {
        'type': 'context',
        'elements': [
          {
            'type': 'mrkdwn',
            'text': `No.${i+1} / ${array[i]}`
          }
        ]
      },
    ]
    );
  }
}
```

ã“ã‚Œã§ã‚‚ã†ä¸€åº¦å®Ÿè¡Œã—ã¦ã¿ã¦slackã«é€ä¿¡ã•ã‚Œã¦ã„ã‚Œã°å¤§ä¸ˆå¤«ã§ã™ã€‚

# ãƒ‡ãƒ—ãƒ­ã‚¤
ã›ã£ã‹ããªã®ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚
[deno deploy](https://deno.com/deploy)ã¨ã„ã†ã®ãŒã‚ã‚Šã¾ã™ãŒã€ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ã‚’ä½¿ç”¨ã—ãŸã„ã®ã§ä»Šå›ã¯herokuã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

https://qiita.com/chibato/items/839e13ab09428dc1481c

ã“ã®è¨˜äº‹ã®é€šã‚Šã«å¤‰æ›´ã‚’è¡Œã£ã¦ãƒ—ãƒƒã‚·ãƒ¥ã—

https://qiita.com/Taro_man/items/2eab3e3acad88c5b759e

ã“ã®è¨˜äº‹ã®é€šã‚Šã«ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ã‚’è¨­å®šã™ã‚Œã°å®Œæˆã§ã™ã€‚
gitè§¦ã£ãŸã“ã¨ãŒã‚ã‚Œã°å•é¡Œç„¡ã„ã¨æ€ã„ã¾ã™ã€‚

# æœ€å¾Œã«
denoåˆã‚ã¦ä½¿ã£ã¦ã¿ã¾ã—ãŸãŒã€tsè§¦ã£ãŸã“ã¨ã‚ã‚‹äººã§ã‚ã‚Œã°å•é¡Œãªãæ›¸ãã“ã¨ãŒã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚

node_modulesãŒç„¡ã„ã“ã¨ã‚„tsãŒåˆã‚ã‹ã‚‰ä½¿ãˆã‚‹ã®ã¯ã¨ã¦ã‚‚ä½“é¨“ãŒã‚ˆãã€å¾Œç™ºã®è¨€èªãªã®ã§æ¨™æº–ã§[deno_lint](https://github.com/denoland/deno_lint)ãªã©ã‚‚ã‚ã‚‹ã®ã§ã“ã‚Œã‹ã‚‰ã‚‚ä½¿ã£ã¦ã„ããŸã„ã¨æ€ã„ã¾ã—ãŸã€‚

é–“é•ã£ã¦ã„ã‚‹ã¨ã“ã‚ã‚ã‚Šã¾ã—ãŸã‚‰ã€æ•™ãˆã¦ã„ãŸã ã‘ã‚‹ã¨ã‚ã‚ŠãŒãŸã„ã§ã™ã€‚